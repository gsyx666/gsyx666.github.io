---
layout:     post
title:      "Smali"
subtitle:   "what-is-smali"
date:       2021-10-22 14:43:01
author:     "gsyx"
catalog: true
header-style: text 
tags:
  - Android 逆向
  - Smali
---

# Smali



## 寄存器



## 数据类型 Type

> [TypesMethodsAndFields · JesusFreke/smali Wiki (github.com)](https://github.com/JesusFreke/smali/wiki/TypesMethodsAndFields#types)

在Java中类型分为基本类型和引用类型

基本类型共有9个，它们在Smali中的对应关系是：

| Smali            | Java     | 备注                                                         |
| ---------------- | -------- | ------------------------------------------------------------ |
| v                | void     | 只能用于返回值类型                                           |
| Z                | boolean  |                                                              |
| B                | byte     |                                                              |
| S                | short    |                                                              |
| C                | char     |                                                              |
| I                | int      |                                                              |
| J                | long     |                                                              |
| F                | float    |                                                              |
| D                | double   |                                                              |
|                  |          | 以上是基本类型                                               |
| `Lpackage/name;` | 对象类型 | `L`表示这是一个对象类型，`package/name`表示该对象所在的包，`；`表示对象名称的结束<br/> `Lpackage/name/ObjectName;` 相当于`java`中的`package.name.ObjectName;` |
| `[类型`          | 数组     | `[I`表示一个`int`型`数组，`[Ljava/lang/String`表示一个`String`的对象`数组` 如果要表示多维数组，只需要增加[的数量，例如[[I表示二维数组int[][] |

## 方法 - Methods



### 表示方法

> [TypesMethodsAndFields · JesusFreke/smali Wiki (github.com)](https://github.com/JesusFreke/smali/wiki/TypesMethodsAndFields#methods)

```smali
Lpackage/name/ObjectName;->MethodName(III)Z
```

在此示例中，您应该识别为**类型**。 name 是方法的名称。 3 ints 是参数，Z (boolen) 是方法返回类型。`Lpackage/name/ObjectName;``MethodName``(III)Z``III``Z`

**当要表达多个参数类型时，只需简单地将它们连接到一起，例如  (int, int, String)  表示为  (IILjava/lang/String;)**

下面是一个更复杂的示例：

```smali
method(I[[IILjava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;
```

在 java 中， 这将是

```java
String method(int, int[][], int, String, Object[])
```

### 方法定义格式

```smali
.method 描述符 方法名(参数类型)返回类型
    方法代码...
.end method
```

其中参数类型可以有0个或多个，返回类型必须是一个。

###  调用方法

Smali中必须以非常详细的形式指定要调用的方法，包括类名、方法名、参数类型和返回类型，其具体形式是：类名->方法名(参数类型)返回类型

例如：

```smali
System.out.println("Hello world");
```

其中 out 是 System 的一个静态字段，它的类型是 PrintStream，println 是 PrintStream 中的一个方法

所以在上一篇的例子中，最后调用 println 方法是通过：

```smali
invoke-virtual {v0, v1}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
```


后面那部分正是方法 println 的完整表达形式

### 方法类型

* `direct method`= private方法
* `virtual method` = 其余的方法

* 方法调用
  * 格式
```java
invoke-指令类型 {参数1, 参数2,...}, L类名;->方法名
```
  * 包含
    * invoke-direct
    * invoke-virtual
    * invoke-static
    * invoke-super
    * invoke-interface
* 函数返回结果
  * 要用指令move-result或move-result-object来保存函数返回的结果









[Home · JesusFreke/smali Wiki (github.com)](https://github.com/JesusFreke/smali/wiki)

[ruanyf/document-style-guide: 中文技术文档的写作规范 (github.com)](https://github.com/ruanyf/document-style-guide)

本文部分图片来自 网络